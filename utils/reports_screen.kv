<BadgeButton@MDCard+ButtonBehavior>:
    ripple_behavior: True

<ReportsScreen>:
    name: 'reports'
    date_label: date_label
    product_spinner: product_spinner
    category_spinner: category_spinner

    FloatLayout:
        MDBoxLayout:
            orientation: 'vertical'
            spacing: 0
            md_bg_color: app.theme_tokens['surface']

            # Cabeçalho Moderno com MDCard
            MDCard:
                size_hint_y: None
                height: dp(70)
                padding: [dp(25), dp(12), dp(25), dp(12)]
                spacing: dp(20)
                elevation: 2
                md_bg_color: app.theme_tokens['card']
                radius: [0, 0, 0, 0]

                MDBoxLayout:
                    spacing: dp(20)

                    # Lado esquerdo - Título e subtítulo
                    MDBoxLayout:
                        orientation: 'vertical'
                        size_hint_x: 0.7
                        spacing: dp(2)
                        adaptive_height: True

                        MDLabel:
                            text: 'Relatórios'
                            font_style: 'H5'
                            bold: True
                            halign: 'left'
                            theme_text_color: 'Custom'
                            text_color: app.theme_tokens['text_primary']
                            size_hint_y: None
                            height: dp(30)

                        MDLabel:
                            text: 'Análise e exportação de dados'
                            font_style: 'Caption'
                            halign: 'left'
                            theme_text_color: 'Custom'
                            text_color: app.theme_tokens['text_secondary']
                            size_hint_y: None
                            height: dp(20)

                    # Lado direito - Botões de ação
                    MDBoxLayout:
                        size_hint_x: 0.3
                        spacing: dp(10)
                        adaptive_height: True

                        Widget:
                            size_hint_x: 0.1

                        MDRaisedButton:
                            text: 'Ver PDFs'
                            size_hint_x: 0.45
                            md_bg_color: app.theme_tokens['card']
                            text_color: app.theme_tokens['primary']
                            elevation: 0
                            line_color: 0.15, 0.52, 0.76, 1
                            line_width: 1.5
                            on_release: root.show_pdf_viewer()

                        MDRaisedButton:
                            text: 'Voltar'
                            size_hint_x: 0.45
                            md_bg_color: app.theme_tokens['card']
                            text_color: app.theme_tokens['danger']
                            elevation: 0
                            line_color: 0.85, 0.3, 0.3, 1
                            line_width: 1.5
                            on_release: root.go_back()

            # Área de conteúdo com scroll
            ScrollView:
                do_scroll_x: False
                do_scroll_y: True
            
                MDBoxLayout:
                    orientation: 'vertical'
                    spacing: dp(20)
                    padding: [dp(25), dp(20), dp(25), dp(25)]
                    size_hint_y: None
                    height: self.minimum_height

                    # Card de Filtros
                    MDCard:
                        orientation: 'vertical'
                        size_hint_y: None
                        height: dp(260)
                        spacing: dp(0)
                        padding: [dp(25), dp(20), dp(25), dp(20)]
                        elevation: 1
                        md_bg_color: app.theme_tokens['card']
                        radius: [dp(8)]

                        # Título do card
                        MDLabel:
                            text: 'Configurar Filtros'
                            font_style: 'H6'
                            bold: True
                            halign: 'left'
                            theme_text_color: 'Custom'
                            text_color: app.theme_tokens['text_primary']
                            size_hint_y: None
                            height: dp(34)

                        Widget:
                            size_hint_y: None
                            height: dp(5)

                        # Filtro de Período
                        MDBoxLayout:
                            size_hint_y: None
                            height: dp(60)
                            spacing: dp(15)
                            adaptive_height: True

                            MDBoxLayout:
                                orientation: 'vertical'
                                size_hint_x: 0.65
                                spacing: dp(6)
                                adaptive_height: True

                                MDLabel:
                                    text: 'Período do Relatório'
                                    font_style: 'Subtitle2'
                                    bold: True
                                    halign: 'left'
                                    theme_text_color: 'Custom'
                                    text_color: app.theme_tokens['text_secondary']
                                    size_hint_y: None
                                    height: dp(20)

                                MDLabel:
                                    id: date_label
                                    text: 'Nenhum período selecionado'
                                    font_style: 'Body2'
                                    halign: 'left'
                                    theme_text_color: 'Custom'
                                    text_color: app.theme_tokens['text_secondary']
                                    size_hint_y: None
                                    height: dp(25)

                            MDRaisedButton:
                                text: 'Selecionar'
                                size_hint_x: 0.35
                                md_bg_color: app.theme_tokens['warning']
                                text_color: app.theme_tokens['on_primary']
                                elevation: 2
                                on_release: root.select_date_range()

                        Widget:
                            size_hint_y: None
                            height: dp(10)

                        # Filtro de Produto
                        MDBoxLayout:
                            size_hint_y: None
                            height: dp(65)
                            spacing: dp(0)
                            orientation: 'vertical'
                            adaptive_height: True

                            MDLabel:
                                text: 'Produto'
                                font_style: 'Subtitle2'
                                bold: True
                                halign: 'left'
                                theme_text_color: 'Custom'
                                text_color: app.theme_tokens['text_secondary']
                                size_hint_y: None
                                height: dp(20)

                            MDRaisedButton:
                                id: product_spinner
                                text: 'Todos os Produtos'
                                md_bg_color: app.theme_tokens['card_alt']
                                text_color: app.theme_tokens['text_primary']
                                elevation: 0
                                on_release: root.open_product_menu(self)

                        Widget:
                            size_hint_y: None
                            height: dp(10)

                        # Filtro de Categoria
                        MDBoxLayout:
                            size_hint_y: None
                            height: dp(65)
                            spacing: dp(0)
                            orientation: 'vertical'
                            adaptive_height: True

                            MDLabel:
                                text: 'Categoria'
                                font_style: 'Subtitle2'
                                bold: True
                                halign: 'left'
                                theme_text_color: 'Custom'
                                text_color: app.theme_tokens['text_secondary']
                                size_hint_y: None
                                height: dp(20)

                            MDRaisedButton:
                                id: category_spinner
                                text: 'Todas as Categorias'
                                md_bg_color: app.theme_tokens['card_alt']
                                text_color: app.theme_tokens['text_primary']
                                elevation: 0
                                on_release: root.open_category_menu(self)

                    Widget:
                        size_hint_y: None
                        height: dp(10)

                    # Título da seção de relatórios
                    MDLabel:
                        text: 'Selecione o Tipo de Relatório'
                        font_style: 'Subtitle1'
                        bold: True
                        halign: 'left'
                        theme_text_color: 'Custom'
                        text_color: app.theme_tokens['text_primary']
                        size_hint_y: None
                        height: dp(35)

                    # Grid de botões de relatórios
                    MDGridLayout:
                        cols: 2
                        spacing: dp(15)
                        size_hint_y: None
                        height: dp(210)
                        adaptive_height: True

                        # Relatório de Vendas
                        MDRaisedButton:
                            text: 'Relatório de Vendas'
                            md_bg_color: app.theme_tokens['primary']
                            text_color: app.theme_tokens['on_primary']
                            font_size: sp(15)
                            elevation: 3
                            on_release: root.generate_sales_report()

                        # Relatório de Estoque
                        MDRaisedButton:
                            text: 'Relatório de Estoque'
                            md_bg_color: app.theme_tokens['success']
                            text_color: app.theme_tokens['on_primary']
                            font_size: sp(15)
                            elevation: 3
                            on_release: root.generate_stock_report()

                        # Relatório de Lucro
                        MDRaisedButton:
                            text: 'Relatório de Lucro'
                            md_bg_color: app.theme_tokens['warning']
                            text_color: app.theme_tokens['on_primary']
                            font_size: sp(15)
                            elevation: 3
                            on_release: root.generate_profit_report()

                        # Relatório Completo
                        MDRaisedButton:
                            text: 'Relatório Completo'
                            md_bg_color: app.theme_tokens['info']
                            text_color: app.theme_tokens['on_primary']
                            font_size: sp(15)
                            elevation: 3
                            on_release: root.generate_complete_report()

                        # Espaçador final
                    Widget:
                        size_hint_y: None
                        height: dp(20)
        FloatLayout:
            id: ai_banner_container
            size_hint: 1, 1
            pos: 0, 0
        MDFloatingActionButton:
            id: ai_button
            icon: "icon/idea.ico"
            elevation: 6
            pos_hint: {"right": 0.965, "y": 0.04}
            on_release: root.open_ai_menu(self)

        # Badge com numero de notificacoes (so aparece quando > 0)
        MDCard:
            id: ai_badge
            size_hint: None, None
            size: dp(24), dp(24)
            md_bg_color: app.theme_tokens['badge']
            radius: [dp(12)]
            elevation: 8
            pos_hint: {"right": 0.978, "y": 0.098}
            opacity: 0

            MDLabel:
                id: ai_badge_label
                text: "0"
                halign: "center"
                valign: "middle"
                theme_text_color: "Custom"
                text_color: app.theme_tokens['on_primary']
                font_size: dp(12)
                bold: True
